#!/bin/sh

chosen="$(echo "$usbdrives" | dmenu -i -p "Mount which drive?")" || exit 1
chosen="$(echo "$chosen" | awk '{print $1}')"
doaspass mount "$chosen" 2>/dev/null && notify-send "ðŸ’» USB mounting" "$chosen mounted." && exit 0
alreadymounted=$(lsblk -nrpo "name,type,mountpoint" | awk '$3!~/\/boot|\/home$|SWAP/&&length($3)>1{printf "-not ( -path *%s -prune ) ",$3}')
getmount "/mnt /media /mount /home -maxdepth 5 -type d $alreadymounted"
partitiontype="$(lsblk -no "fstype" "$chosen")"
case "$partitiontype" in
  "vfat") doaspass mount -t vfat "$chosen" "$mp" -o rw,umask=0000;;
  "exfat") doaspass mount "$chosen" "$mp" -o uid="$(id -u)",gid="$(id -g)";;
  *) doaspass mount "$chosen" "$mp"; user="$(whoami)"; ug="$(groups | awk '{print $1}')"; doaspass chown "$user":"$ug" "$mp";;
esac
notify-send "ðŸ’» USB mounting" "$chosen mounted to $mp."
